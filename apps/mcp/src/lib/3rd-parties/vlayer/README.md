# VLayer Web Proof Integration

This module provides web proof generation and parsing functionality for MCP servers using the VLayer web prover service.

## Features

- **Fetch Wrapper**: Automatically generates web proofs for HTTP requests
- **Web Proof Parser**: Extracts and parses web proof data from hex blobs
- **Response Analysis**: Convenient functions to extract request/response data from proofs
- **TypeScript Support**: Full type safety and IntelliSense support

## Quick Start

### Basic Usage

```typescript
import { VLayer } from './index.js';
import { extractResponseJson, extractRequestData } from './webproof-parser.js';

// Create a fetch wrapper that generates web proofs
const proofedFetch = VLayer.createFetchWrapper();

// Use it like regular fetch
const result = await proofedFetch('https://api.example.com/data', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ query: 'test' })
});

console.log('Response status:', result.response.status);

if (result.proof) {
  console.log('Web proof generated:', result.proof.presentation);
  
  // Extract data from the proof
  const requestData = extractRequestData(result.response, result.proof.presentation);
  const responseData = extractResponseJson(result.response, result.proof.presentation);
  
  console.log('Request URL:', requestData?.url);
  console.log('Response data:', responseData);
}
```

### MCP Server Integration

```typescript
import { VLayer } from './index.js';

// For MCP server requests with payment headers
const result = await proofedFetch('https://vercel-mcp-handler-mcpay.vercel.app/mcp', {
  method: 'POST',
  headers: {
    'content-type': 'application/json',
    'x-mcpay-wallet-address': '0xf1C8dD10Ddb27F65fd5Bda7B12B61542A0Cf53B7',
    'x-payment': 'eyJ4NDAyVmVyc2lvbiI6MSwic2NoZW1lIjoiZXhhY3QiLCJuZXR3b3JrIjoic2VpLXRlc3RuZXQiLCJwYXlsb2FkIjp7InNpZ25hdHVyZSI6IjB4MWEwMmM1YjhhNmNjZTkzZmQwMDZjMTA1YzZjNTkxNDk0YjZiZmQ5YmY4YzI0YWY1YTMxZDhhMmM2ZTdiZDBmMjZlMDUyNGU1OTY4MzdkNmI1N2VjODkwNDkwYTk1MDZlYjUwZjk3ZDQ0OTg5ZDJmNjNjMDllNDk3NjI3OWIxODkxYiIsImF1dGhvcml6YXRpb24iOnsiZnJvbSI6IjB4ZjFDOGREMTBEZGIyN0Y2NWZkNUJkYTdCMTJCNjE1NDJBMENmNTNCNyIsInRvIjoiMHhmMUM4ZEQxMERkYjI3RjY1ZmQ1QmRhN0IxMkI2MTU0MkEwQ2Y1M0I3IiwidmFsdWUiOiI1MDAwIiwidmFsaWRBZnRlciI6IjE3NTYyMzM0MjMiLCJ2YWxpZEJlZm9yZSI6IjE3NTYyMzQwODMiLCJub25jZSI6IjB4NzVjZDdiNmFjZWI4NGExYTA2NGY1OWY5NThiNzk2MTZmMzgyYzFlNDNlNDIwYTA2NTA3MTdiNTRkZjU0NjUwMCJ9fX0=',
    'x-wallet-provider': 'coinbase-cdp',
    'x-wallet-type': 'managed'
  },
  body: JSON.stringify({
    jsonrpc: '2.0',
    id: 2,
    method: 'tools/call',
    params: { name: 'create_session', arguments: {} }
  })
});
```

### Parsing Existing Web Proofs

```typescript
import { parseWebProofHex } from './webproof-parser.js';

// Parse a hex proof blob
const proofHex = "0140000000000000008e6a0e4d79b5d715f85b88d4729674e2b278e37f4c074012b257ed43b5cdd8eb1f26ce398581f785d429d375e259b2d900cc20c77b9dadead32ed577e96a99ba7ea3a01a89afc05a9bdd6475d482fa53000000000220000000000000001c6fa4a33479f5867523ab819467b8349265cf769adbfc2c2c820a74165f7a480000000001210000000000000002d4cbba990b0c2eb1dd45b29c7d26075299f1ea39317f35140e6ef71e703beda70100000088739b680000000000000000e2010000fb260000020000000000000041000000000000000471861b512d7565e14a05120f8b7d4407a20a62c3afb221a1433fa9cc5df0ad10ca5b9a3b48e410699cbc5ac625642db8042d6fc7702c81e7b2927e0d3309c848030000000220000000000000006cf2819614eb1dd5a1476af1756d6f7edbd07cd43a1b33cb0b36a7f3fbde219d0104000000022000000000000000f67d41cc9dd57cec079f0062c8dd21d4a756e950295fa2dada5fd0c2f6288409555175ae4ffe07c692d559969b0a98ef5eb79d2596af51c1866e529d9fc2f4c431773c908137beb7a62ffab419e65105000000000000000002050000000000000000000000000000000119000000000000006d637061792d746563682d6465762e76657263656c2e6170700200000000000000050500000000000030820501308203e9a003020102021206e0911b48b03062893d1dc6e1613e5e3acb300d06092a864886f70d01010b05003033310b300906035504061302555331163014060355040a130d4c6574277320456e6372797074310c300a06035504031303523131301e170d3235303632343034353733325a170d3235303932323034353733315a30173115301306035504030c0c2a2e76657263656c2e61707030820122300d06092a864886f70d01010105000382010f003082010a0282010100b8f5a86097d6a306ba51a89c33f830f3e461a44ceb8b0681eec6cc3b9608e957758c3f0e6a9198f2efdd1dff4cc8779934f9f3dde7cc1e4abe118239f896ee6e1c04098b150fb13fe23a1c0250d82ba2982384af422673525fcbc72a3f038682a6be940a93d01e1eaccd642372373080a74468e3cc68d46a413b5c2f904fd358322bd0ebc2bedf21958114c5ffa0b74eeb629067a1aa2b0d793795c6bc4748e553e10c4a1ee9ae71958d1d1afd6453ed9871c7a6f47f92dbaf26e722931ca5877a639f545341e768679564278979b20314319273c9a3ddd3431de22e011d40ef12dcb78962f6df3dfd4cf1ee3cf90c51eb1b38e1afc68561fdaf76849d6717430203010001a382022930820225300e0603551d0f0101ff0404030205a0301d0603551d250416301406082b0601050507030106082b06010505070302300c0603551d130101ff04023000301d0603551d0e0416041452bc0ee7700b3d55c5a01d681a12d59e1d12c1fe301f0603551d23041830168014c5cf46a4eaf4c3c07a6c95c42db05e922f26e3b9303306082b0601050507010104273025302306082b060105050730028617687474703a2f2f7231312e692e6c656e63722e6f72672f30230603551d11041c301a820c2a2e76657263656c2e617070820a76657263656c2e61707030130603551d20040c300a3008060667810c010201302e0603551d1f042730253023a021a01f861d687474703a2f2f7231312e632e6c656e63722e6f72672f37362e63726c30820105060a2b06010401d6790204020481f60481f300f1007700a442c506496061548f0fd4ea9cfb7a2d26454d87a97f2fdf4559f6274f3a845400000197a082028c0000040300483046022100d7a78b0ec9c782bf31537e8018f2cfd99cf5869af882ef8f9705d883c82a1fc6022100ceb9ca23b11872b7ce5be6729f0d5fb43961027c82a5c660fbad1dbedac409dd00760012f14e34bd53724c840619c38f3f7a13f8e7b56287889c6d300584ebe586263a00000197a082098a0000040300473045022100d48acd834976255c3fe3c417dd0c18eee8785f071db7856ef2390204eb743dcf0220353e68ca65ac6ea1496698e1d9de48d4ed44a6b6456d7674bc021ad4d22ca7b3300d06092a864886f70d01010b05000382010100920305c67c2982b577a9b9d756a4d6f3d806abb8e0b4c79b9b28b67fb1a07c2dcd849bc36c0d7b4613e2a593cb51a676137a4830bb82b7323470a711864e601d66b80c351d484dd0db992306a5e2b7d2b796addd6d07aea90de739db0806ca2523136c960dd7b023eaae71f2f478dd40ea2f6c48431142c7873644f9d5e31ddb634719513af37532063d9aeecea4f6f69f0d0929de13f4114b8d807732a424068ac5e125a6882eb0e272270743587898c1700c133036d34f1b5d969bc161872dd8520d3aadf0f5abe8257f4f0784046ddaf9dc5b2418fb1a82888e3fc3e1356081d17712e33eafb8fa9b999bf0fd507de2df59eeb69da131da4f8e385b6d00180a0500000000000030820506308202eea0030201020211008a7d3e13d62f30ef2386bd29076b34f8300d06092a864886f70d01010b0500304f310b300906035504061302555331293027060355040a1320496e7465726e65742053656375726974792052657365617263682047726f7570311530130603550403130c4953524720526f6f74205831301e170d3234303331333030303030305a170d3237303331323233353935395a3033310b300906035504061302555331163014060355040a130d4c6574277320456e6372797074310c300a0603550403130352313130820122300d06092a864886f70d01010105000382010f003082010a0282010100ba87bc5c1b0039cbca0acdd46710f9013ca54ea561cb26ca52fb1501b7b928f5281eed27b324183967090c08ece03ab03b770ebdf3e53954410c4eae41d69974de51dbef7bff58bda8b713f6de31d5f272c9726a0b8374959c4600641499f3b1d922d9cda892aa1c267a3ffeef58057b089581db710f8efbe33109bb09be504d5f8f91763d5a9d9e83f2e9c466b3e106664348188065a037189a9b843297b1b2bdc4f815009d2788fbe26317966c9b27674bc4db285e69c279f0495ce02450e1c4bca105ac7b406d00b4c2413fa758b82fc55c9ba5bb099ef1feebb08539fda80aef45c478eb652ac2cf5f3cdee35c4d1bf70b272baa0b4277534f796a1d87d90203010001a381f83081f5300e0603551d0f0101ff040403020186301d0603551d250416301406082b0601050507030206082b0601050507030130120603551d130101ff040830060101ff020100301d0603551d0e04160414c5cf46a4eaf4c3c07a6c95c42db05e922f26e3b9301f0603551d2304183016801479b459e67bb6e5e40173800888c81a58f6e99b6e303206082b0601050507010104263024302206082b060105050730028616687474703a2f2f78312e692e6c656e63722e6f72672f30130603551d20040c300a3008060667810c01020130270603551d1f0420301e301ca01aa0188616687474703a2f2f78312e632e6c656e63722e6f72672f300d06092a864886f70d01010b050003820201004ee2895d0a031c9038d0f51ff9715cf8c38fb237887a6fb0251fedbeb7d886068ee90984cd72bf81f3fccacf5348edbdf66942d4a5113e35c813b2921d055fea2ed4d8f849c3adf599969cef26d8e1b4240b48204dfcd354b4a9c621c8e1361bff77642917b9f04bef5deacd79d0bf90bfbe23b290da4aa9483174a9440be1e2f62d8371a4757bd294c10519461cb98ff3c47448252a0de5f5db43e2db939bb919b41f2fdf6a0e8f31d3630fbb29dcdd662c3fb01b6751f8413ce44db9acb8a49c6663f5ab85231dcc53b6ab71aedcc50171da36ee0a182a32fd09317c8ff673e79c9cb54a156a77825acfda8d45fe1f2a6405303e73c2c60cb9d63b634aab4603fe99c04640276063df503a0747d8154a9fea471f995a08620cb66c33084dd738ed482d2e0568ae805def4cdcd820415f68f1bb5acde30eb00c31879b43de4943e1c8043fd13c1b87453069a8a9720e79121c31d83e2357dda74fa0f01c81d1771f6fd6d2b9a8b3031681394b9f55aed26ae4b3bfeaa5d59f4ba3c9d63b72f34af654ab0cfc38f76080df6e35ca75a154e42fbc6e17c91aa537b5a29abaecf4c075464f77a8e8595691662d6ede2981d6a697055e6445be2cceea644244b0c34fadf0b4dc03ca999b098295820d638a66f91972f8d5b98910e289980935f9a21cbe92732374e99d1fd73b4a9a845810c2f3a7e235ec7e3b45ce3046526bc0c00a000000000100000000000065622128c866b791fedb07b4fe19ff90a36446abac48cd2e7abbcd20ab1a39977bc7881f48152b1d3124a133b7c0f5cb6d5704d18194947d725e635c9c505ac63cad15bfedc92d645d6402010dbc6c6e2adecf736d451cf60ed9aeb00b9c34c403b184127e869485f16648bbd571299c6fd83ebfe83a23ba7b8b7ccfd2326fb36083aaa48044c88f3e33fcff4b0d5965979692e7145e502fb16b9d1b213f7d73b84b17a9baf906c9c16358117a5b47d73a6a74eeb27218068b3f5ff059089ad8137c99a63dd34bc273adaa1a11fe0963ffeb9cbbc9a95001b41bbec588c629029eaaa62bde78c0f0f6e9e45a342385efa18f83f1afd7b39094dbd64e53e78aae000000002fb4376f99c2ee858899bc63b1187e9454622f91c7dbf1d00ac912a164c2d49d04d3344a1e59a56cbead16ffe52c303497e1b7c0ca800d64444f574e475244010000000041000000000000000471861b512d7565e14a05120f8b7d4407a20a62c3afb221a1433fa9cc5df0ad10ca5b9a3b48e410699cbc5ac625642db8042d6fc7702c81e7b2927e0d3309c848e7b8475a6598ee58134b3553ca3b6afb01010202000000000000000000000000000000020000000000000001000000000000000100000001000000000000000000000000000000fb26000000000000fb26000000000000485454502f312e3120323030204f4b0d0a4163636573732d436f6e74726f6c2d416c6c6f772d43726564656e7469616c733a20747275650d0a4163636573732d436f6e74726f6c2d416c6c6f772d4f726967696e3a202a0d0a4163636573732d436f6e74726f6c2d4578706f73652d486561646572733a202a0d0a43616368652d436f6e74726f6c3a206e6f2d63616368650d0a436f6e74656e742d547970653a20746578742f6576656e742d73747265616d0d0a446174653a205475652c2031322041756720323032352031373a30323a303120474d540d0a5365727665723a2056657263656c0d0a5374726963742d5472616e73706f72742d53656375726974793a206d61782d6167653d36333037323030303b20696e636c756465537562446f6d61696e733b207072656c6f61640d0a566172793a205253432c204e6578742d526f757465722d53746174652d547265652c204e6578742d526f757465722d50726566657463682c204e6578742d526f757465722d5365676d656e742d50726566657463680d0a582d4d6174636865642d506174683a202f6d63702f5b5b2e2e2e726f7574655d5d0d0a582d56657263656c2d43616368653a204d4953530d0a582d56657263656c2d49643a20636467313a636467313a667261313a3a696164313a3a667261313a3a7436377a6a2d313735353031383132313534312d6130343130613261653334330d0a436f6e6e656374696f6e3a20636c6f73650d0a5472616e736665722d456e636f64696e673a206368756e6b65640d0a0d0a323461660d0a6576656e743a206d6573736167650a646174613a207b22726573756c74223a7b22746f6f6c73223a5b7b226e616d65223a226372656174655f73657373696f6e222c226465736372697074696f6e223a22437265617465732061206e6577204d4350207365727665722073657373696f6e20776974682064656661756c742074656d706c6174655c6e494d504f5254414e543a205061796d656e742064657461696c733a5c6e50726963653a20302e30303520555344202d20526563697069656e743a20756e646566696e6564222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b7d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d2c22616e6e6f746174696f6e73223a7b227061796d656e74223a7b2274797065223a2273696d706c65222c227072696365223a302e3030352c2263757272656e6379223a22555344227d7d7d2c7b226e616d65223a226164645f6f725f7570646174655f66696c65222c226465736372697074696f6e223a2241646473206f72207570646174657320612066696c6520696e207468652073657373696f6e222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c2270617468223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a2246696c6520706174682072656c617469766520746f2070726f6a65637420726f6f74227d2c22636f6e74656e74223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a2246696c6520636f6e74656e74227d7d2c227265717569726564223a5b2273657373696f6e4964222c2270617468222c22636f6e74656e74225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a2264656c6574655f66696c65222c226465736372697074696f6e223a2252656d6f76657320612066696c652066726f6d207468652073657373696f6e222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c2270617468223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a2246696c65207061746820746f2064656c657465227d7d2c227265717569726564223a5b2273657373696f6e4964222c2270617468225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a226765745f66696c65222c226465736372697074696f6e223a22466574636865732066696c6520636f6e74656e74732066726f6d207468652073657373696f6e222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c2270617468223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a2246696c65207061746820746f207265747269657665227d7d2c227265717569726564223a5b2273657373696f6e4964222c2270617468225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a226c6973745f66696c6573222c226465736372697074696f6e223a224c6973747320616c6c2066696c6520706174687320696e207468652073657373696f6e222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a226765745f616c6c5f636f646562617365222c226465736372697074696f6e223a2247657420616c6c2066696c6573207769746820746865697220706174687320616e6420636f6e74656e74732066726f6d207468652073657373696f6e222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c22696e636c756465436f6e74656e74223a7b2274797065223a22626f6f6c65616e222c2264656661756c74223a747275652c226465736372697074696f6e223a225768657468657220746f20696e636c7564652066696c6520636f6e74656e7473202864656661756c743a207472756529227d2c227061746846696c746572223a7b2274797065223a22737472696e67222c2264656661756c74223a22222c226465736372697074696f6e223a22506174682066696c746572207061747465726e202d20656d70747920737472696e672072657475726e7320616c6c2066696c65732028652e672e2c20272a2e7473272c20277372632f2a2a272c206f7220272720666f7220616c6c29227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a2270726576696577222c226465736372697074696f6e223a225472696767657273206465706c6f796d656e7420746f2056657263656c2053616e64626f7820616e642072657475726e732070726576696577206c696e6b5c6e494d504f5254414e543a205061796d656e742064657461696c733a5c6e50726963653a20302e30303520555344202d20526563697069656e743a20756e646566696e6564222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d2c22616e6e6f746174696f6e73223a7b227061796d656e74223a7b2274797065223a2273696d706c65222c227072696365223a302e3030352c2263757272656e6379223a22555344227d7d7d2c7b226e616d65223a226164645f646570656e64656e6379222c226465736372697074696f6e223a22416464206120646570656e64656e637920746f207468652073657373696f6e2773207061636b6167652e6a736f6e222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c227061636b6167654e616d65223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a22546865206e616d65206f6620746865207061636b61676520746f20616464227d2c2276657273696f6e223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652076657273696f6e206f6620746865207061636b616765202864656661756c747320746f206c617465737429227d2c226973446576223a7b2274797065223a22626f6f6c65616e222c2264656661756c74223a66616c73652c226465736372697074696f6e223a2257686574686572207468697320697320612064657620646570656e64656e6379202864656661756c747320746f2066616c736529227d7d2c227265717569726564223a5b2273657373696f6e4964222c227061636b6167654e616d65225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a226765745f656e7669726f6e6d656e745f696e666f222c226465736372697074696f6e223a2247657420696e666f726d6174696f6e2061626f7574207468652063757272656e7420656e7669726f6e6d656e7420616e64206465706c6f796d656e74206361706162696c6974696573222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b7d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a226765745f73657373696f6e5f7374617473222c226465736372697074696f6e223a2247657420737461746973746963732061626f757420612073657373696f6e222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a22646f776e6c6f61645f73657373696f6e222c226465736372697074696f6e223a22437265617465732061205a49502066696c65206f66207468652073657373696f6e20616e642073746f72657320697420696e20626c6f622073746f726167652c2072657475726e696e67206120646f776e6c6f61642055524c5c6e494d504f5254414e543a205061796d656e742064657461696c733a5c6e50726963653a20302e30303520555344202d20526563697069656e743a20756e646566696e6564222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e20494420746f20646f776e6c6f6164227d2c2266696c656e616d65223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a22437573746f6d2066696c656e616d6520666f7220746865205a49502066696c652028776974686f757420657874656e73696f6e29227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d2c22616e6e6f746174696f6e73223a7b227061796d656e74223a7b2274797065223a2273696d706c65222c227072696365223a302e3030352c2263757272656e6379223a22555344227d7d7d2c7b226e616d65223a22666f7263655f726566726573685f73616e64626f78222c226465736372697074696f6e223a22436c65617273206361636865642073616e64626f7820696e666f20746f20666f726365206372656174696f6e206f662061206e65772073616e64626f78206f6e206e6578742070726576696577222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a2273746f705f70726576696577222c226465736372697074696f6e223a2253746f7073207468652063757272656e74207072657669657720627920636c656172696e672073616e64626f7820636163686520616e64207465726d696e6174696e6720746865206465706c6f796d656e74222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a2264656275675f7061636b6167655f6a736f6e222c226465736372697074696f6e223a2253686f7773207468652063757272656e74207061636b6167652e6a736f6e20636f6e74656e7420616e642068656c707320646961676e6f7365206e706d20696e7374616c6c20697373756573222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a2272756e5f636f6d6d616e64222c226465736372697074696f6e223a224578656375746520616e79207368656c6c20636f6d6d616e6420696e7369646520746865206c6976652073616e64626f785c6e494d504f5254414e543a205061796d656e742064657461696c733a5c6e50726963653a20302e30303520555344202d20526563697069656e743a20756e646566696e6564222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c22636d64223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a2254686520636f6d6d616e6420746f2065786563757465227d2c2261726773223a7b2274797065223a226172726179222c226974656d73223a7b2274797065223a22737472696e67227d2c226465736372697074696f6e223a22436f6d6d616e6420617267756d656e7473227d2c22637764223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a22576f726b696e67206469726563746f7279202864656661756c747320746f202f76657263656c2f73616e64626f7829227d7d2c227265717569726564223a5b2273657373696f6e4964222c22636d64225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d2c22616e6e6f746174696f6e73223a7b227061796d656e74223a7b2274797065223a2273696d706c65222c227072696365223a302e3030352c2263757272656e6379223a22555344227d7d7d2c7b226e616d65223a2274735f636865636b222c226465736372697074696f6e223a2252756e73205479706553637269707420636f6d70696c65722028747363202d2d6e6f456d69742920746f20737572666163652074797065206572726f7273222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a226e706d5f6175646974222c226465736372697074696f6e223a22506572666f726d73206e706d206175646974202d2d6f6d69743d64657620666f722076756c6e65726162696c697479207363616e222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a22636f6d6d6974222c226465736372697074696f6e223a22536176657320612066756c6c20736e617073686f74206f6620616c6c2073657373696f6e2066696c65732077697468206120636f6d6d6974206d657373616765222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c226d657373616765223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a22436f6d6d6974206d6573736167652064657363726962696e6720746865206368616e676573227d7d2c227265717569726564223a5b2273657373696f6e4964222c226d657373616765225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a2264696666222c226465736372697074696f6e223a2253686f777320756e69666965642064696666206265747765656e2074776f20636f6d6d697473222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c2266726f6d223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a22536f7572636520636f6d6d6974204944227d2c22746f223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a2254617267657420636f6d6d6974204944227d7d2c227265717569726564223a5b2273657373696f6e4964222c2266726f6d222c22746f225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a22666f726d61745f66696c65222c226465736372697074696f6e223a22466f726d61747320612073696e676c652066696c65207769746820507265747469657220616e6420777269746573206974206261636b222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c2270617468223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a2246696c65207061746820746f20666f726d6174227d7d2c227265717569726564223a5b2273657373696f6e4964222c2270617468225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a226765745f6c6f6773222c226465736372697074696f6e223a2252657475726e7320746865206c6174657374206275696c642f72756e74696d65206c6f677320636170747572656420647572696e672070726576696577222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d2c7b226e616d65223a2273747265616d5f6c6f6773222c226465736372697074696f6e223a224c6976652d7461696c206c617374204e206c696e65732066726f6d2073616e64626f78206c6f672066696c65735c6e494d504f5254414e543a205061796d656e742064657461696c733a5c6e50726963653a20302e30303520555344202d20526563697069656e743a20756e646566696e6564222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c226c696e6573223a7b2274797065223a226e756d626572222c2264656661756c74223a3230302c226465736372697074696f6e223a224e756d626572206f66206c696e657320746f207461696c202864656661756c742032303029227d7d2c227265717569726564223a5b2273657373696f6e4964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d2c22616e6e6f746174696f6e73223a7b227061796d656e74223a7b2274797065223a2273696d706c65222c227072696365223a302e3030352c2263757272656e6379223a22555344227d7d7d2c7b226e616d65223a22726576657274222c226465736372697074696f6e223a22526573746f7265732066696c65732066726f6d206120737065636966696320636f6d6d6974222c22696e707574536368656d61223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b2273657373696f6e4964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a225468652073657373696f6e204944227d2c22636f6d6d69744964223a7b2274797065223a22737472696e67222c226465736372697074696f6e223a22436f6d6d697420494420746f20726573746f72652066726f6d227d7d2c227265717569726564223a5b2273657373696f6e4964222c22636f6d6d69744964225d2c226164646974696f6e616c50726f70657274696573223a66616c73652c2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123227d7d5d7d2c226a736f6e727063223a22322e30222c226964223a317d0a0a0d0a300d0a0d0ab1bcfd49ac2329b442188b35bee907f300000000000000000000000001000000000000000000000000000000e201000000000000e201000000000000504f53542068747470733a2f2f6d637061792d746563682d6465762e76657263656c2e6170702f6d63702f37336235343439332d303438642d343433332d383638372d66646632646331656266346420485454502f312e310d0a686f73743a206d637061792d746563682d6465762e76657263656c2e6170700d0a6163636570743a202a2f2a0d0a6163636570743a206170706c69636174696f6e2f6a736f6e2c20746578742f6576656e742d73747265616d0d0a6163636570742d656e636f64696e673a206964656e746974790d0a636f6e6e656374696f6e3a20636c6f73650d0a757365722d6167656e743a204d6f7a696c6c612f352e3020285831313b204c696e7578207838365f363429204170706c655765624b69742f3533372e333620284b48544d4c2c206c696b65204765636b6f29204368726f6d652f3131342e302e302e30205361666172692f3533372e33360d0a636f6e74656e742d747970653a206170706c69636174696f6e2f6a736f6e0d0a782d6170692d6b65793a202a2a2a2a2a2a2a2a2a2a2a2a2a2a2a0d0a636f6e74656e742d6c656e6774683a2035380d0a0d0a7b226a736f6e727063223a22322e30222c226964223a312c226d6574686f64223a22746f6f6c732f6c697374222c22706172616d73223a7b7d7de530ff16dc42d10f55d6482a3120f9560000000000000000";

const parsed = parseWebProofHex(proofHex);
console.log('Request headers:', parsed.request?.headers);
console.log('Response body JSON:', parsed.response?.bodyJson);
console.log('Response headers:', parsed.response?.headers);
```

## API Reference

### VLayer Class

#### `VLayer.createFetchWrapper(originalFetch?: typeof fetch)`

Creates a fetch wrapper that automatically generates web proofs for requests.

**Parameters:**
- `originalFetch` (optional): The original fetch function to wrap. Defaults to global `fetch`.

**Returns:**
- A function that behaves like `fetch` but returns a `ProofedResponse` with web proof data.

#### `VLayer.generateWebProof(request: WebProofRequest)`

Generates a web proof for a given request.

**Parameters:**
- `request`: The web proof request object containing URL, method, headers, and body.

**Returns:**
- Promise resolving to a `WebProofResponse` with the proof presentation.

#### `VLayer.validateWebProof(webProof: WebProofResponse)`

Validates a web proof presentation.

**Parameters:**
- `webProof`: The web proof response to validate.

**Returns:**
- Boolean indicating if the proof is valid.

### Web Proof Parser Functions

#### `parseWebProofHex(hex: string)`

Parses a vlayer web proof hex blob and extracts request/response data.

**Parameters:**
- `hex`: The hex string containing the web proof.

**Returns:**
- `ParsedWebProof` object with request and response data.

#### `extractWebProofData(response: Response, proofPresentation?: string)`

Extracts web proof data from a Response object and its associated proof.

**Parameters:**
- `response`: The Response object.
- `proofPresentation`: The proof presentation string.

**Returns:**
- `ParsedWebProof` object or `null` if extraction fails.

#### `extractResponseJson(response: Response, proofPresentation?: string)`

Extracts JSON data from a Response object using web proof.

**Parameters:**
- `response`: The Response object.
- `proofPresentation`: The proof presentation string.

**Returns:**
- Parsed JSON object or `null`.

#### `extractResponseHeaders(response: Response, proofPresentation?: string)`

Extracts headers from a Response object using web proof.

**Parameters:**
- `response`: The Response object.
- `proofPresentation`: The proof presentation string.

**Returns:**
- Headers object or `null`.

#### `extractRequestData(response: Response, proofPresentation?: string)`

Extracts request data from a Response object using web proof.

**Parameters:**
- `response`: The Response object.
- `proofPresentation`: The proof presentation string.

**Returns:**
- Request data object or `null`.

## Types

### `WebProofRequest`
```typescript
interface WebProofRequest {
  url: string;
  method: 'GET' | 'POST';
  headers: string[];
  body?: string;
}
```

### `WebProofResponse`
```typescript
interface WebProofResponse {
  presentation: string;
}
```

### `ProofedResponse`
```typescript
interface ProofedResponse {
  response: Response;
  proof?: WebProofResponse;
}
```

### `ParsedWebProof`
```typescript
interface ParsedWebProof {
  url: string | null;
  request: ParsedRequest | null;
  response: ParsedResponse | null;
  notaryPubKey?: string | null;
}
```

## Error Handling

The module includes comprehensive error handling:

- Web proof generation failures are logged as warnings and don't interrupt the fetch
- Parsing errors are caught and handled gracefully
- Invalid proofs return `null` instead of throwing errors
- All functions include proper TypeScript error types

## Dependencies

- `jmespath`: For JSON path querying
- `@types/jmespath`: TypeScript definitions for jmespath

## Security Notes

⚠️ **Important**: This module performs no cryptographic verification. The web proofs are generated by the VLayer service, but for trust-minimized use cases, you should verify proofs on-chain or via vlayer precompiles.

The module is designed for:
- Off-chain analysis and debugging
- Building reputation systems
- Quality scoring for MCP servers
- Development and testing workflows

For production use requiring cryptographic guarantees, implement proper verification mechanisms.
